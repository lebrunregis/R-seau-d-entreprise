@model ReseauEntreprise.Areas.Employee.Models.ViewModels.EmployeeTeam.EmployeesInTeamForm

<h3>@Model.team.Name</h3>

<table class="table">
	<tr>
		<th>
			@Html.DisplayNameFor(model => model.Employees.FirstOrDefault().Employee)
		</th>
		<th>
			@Html.DisplayNameFor(model => model.Employees.FirstOrDefault().Departments)
		</th>
		<th>
			@Html.DisplayNameFor(model => model.Employees.FirstOrDefault().IsInTeam)
		</th>
	</tr>

	@for (int i = 0; i < Model.Employees.Count(); i++)
	{
		var item = Model.Employees.ElementAt(i);
		<tr>
			<td>
				@{ Html.RenderPartial("_Employee", item.Employee); }
			</td>
			<td>
				@{ Html.RenderPartial("_DepartmentList", item.Departments); }
			</td>
			<td>
				<div class="checkbox">
					@Html.CheckBoxFor(m => m.Employees.ElementAt(i).IsInTeam, new { id = item.Employee.Employee_Id })
				</div>
			</td>
		</tr>
	}

</table>


@Html.ActionLink("Back to team", "Details", new { id = Model.team.Id}) <br />
@Html.ActionLink("Back to list", "Index")

<script>
	var checkboxes = document.querySelectorAll('input[name="IsInTeam"][type="checkbox"]');

	for (var i = 0; i < checkboxes.length; i++) {
		checkboxes[i].addEventListener("change", (event) => {

			function onsuccess(responseData) {
				if (responseData == true) {
					checkbox.checked = true
				}
				else {
					checkbox.checked = false
				}
			}

			var checkbox = event.target;
			var requestData = { EmployeeId: checkbox.id, IsChecked: checkbox.checked };
			if (checkbox.checked == true) {
				checkbox.checked = false
			}
			else {
				checkbox.checked = true
			}
			$.post(window.location.href, requestData, onsuccess);
		})
	}
</script>
